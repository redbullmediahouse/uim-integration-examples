const crypto = require('crypto');

const message1 = '{"userId":"6054ab12c988f0047291ba7f","siloUserId":"6054ab12c988f0047291ba80","applicationId":"5b2ce30bd9a0bf285ac70c10","applicationName":"Red Bull","createdAt":"2021-03-22T15:26:10.275Z","type":"REGISTRATION_VERIFIED","info":{"socialMediaAccounts":[],"accepted_newsletters":[],"formSubmissionId":"6058b71237ccda2ea3663cb2","origin":"native","verifiedAt":"2021-03-22T15:26:10.275149Z","language":"en","source":"HQ_The-Cans-Are-Out-There-HQ-Placeholder-for-Jotform_03_21","avatar":{},"unmappedFields":{},"rawRequest":"{\"slug\":\"submit/210744869485065/\",\"q3_name\":{\"first\":\"Pablo\",\"last\":\"Torregrosa\"},\"q4_email\":\"pablo.torregrosapaez@redbull.com\",\"q6_typeA\":\"{\\\"widgetName\\\":\\\"consent\\\",\\\"policyTypes\\\":[\\\"privacy\\\"],\\\"customPolicies\\\":[{\\\"type\\\":\\\"participation\\\",\\\"url\\\":\\\"www.redbull.com\\\"}],\\\"newsletters\\\":[],\\\"snippets\\\":[],\\\"country\\\":\\\"INT\\\",\\\"lang\\\":\\\"en\\\",\\\"formAlias\\\":\\\"rb_the_cans_are_out_there_2021\\\",\\\"source\\\":\\\"HQ_The-Cans-Are-Out-There-HQ-Placeholder-for-Jotform_03_21\\\",\\\"lucidId\\\":\\\"L1184-1\\\"}\",\"event_id\":\"1616426736032_210744869485065_kcJlYeV\",\"enterprise_server\":\"redbull.jotform.com\"}","externalFormId":"210744869485065","externalSystemId":"jotform","verificationPending":false,"userType":"registered","fields":[{"key":"first_name","value":"Pablo","mandatory":true,"type":"TEXT"},{"key":"last_name","value":"Torregrosa","mandatory":true,"type":"TEXT"},{"key":"email","value":"pablo.torregrosapaez@redbull.com","mandatory":true,"type":"TEXT","verified":true}],"lucidId":"L1184-1","submittedAt":"2021-03-22T15:26:10.275149Z","formAlias":"rb_the_cans_are_out_there_2021","userConsents":[{"masterDocumentId":"b1478104-6594-41ef-906b-abba99d20ab2","documentId":"b5edb2c5-69a8-4059-84c5-354a7a9483f3","title":"Privacy Policy - Automation - International","mandatory":true,"accepted":true,"type":"privacy","version":"9","timeOfConsent":"2021-03-22T15:26:10.295Z","url":"https://policies.redbull.com/policies/Red_Bull_Global/202101121100/en/privacy.html","custom":false,"renderingType":"implicit"},{"masterDocumentId":"7e156272-5ecc-4824-95c6-f6a4a399636a","documentId":"custom_0e06bf1e-9af3-4030-83c2-3917d5269dd6","title":"custom_participation","mandatory":false,"accepted":true,"type":"participation","version":"custom_policy_version_1","timeOfConsent":"2021-03-22T15:26:10.316387Z","url":"www.redbull.com","custom":true,"renderingType":"explicit"}]},"geoLocation":{"country":"DE","city":"FRANKFURT","latitude":"50.12","longitude":"8.68"},"advertising":{}}';
// This should be read from the header X-UIM-RSA-Signature-value
const signature1 = 'A56CdyXRYvv96uv02ddpZoLAtD9WKRjDeLqenL75VvVljh/XoEDmfINig8UeF76JgfQtsWiUQMxKXVmHg6+iBfJbogFAfwsq//XA+yCVIy15up8RnV4I5ZUIBolmZDiHgRXf4zjL3DveMDDq50W2R9SVLYgpzKaL12hJnc52y+PgDJUB4Hus57yQw1aU2MLBcIyC71wZmMSCU/nPy9m6dy72AGiLjkd/4SpId2nhPPWE/SNPzhsocGH2s8O7NIsCd+ECqljjH7Sy8+fKn8Yop25/h2SDrmM5Br5ppGi+EsdWfrzTFK8FoZPJykMOags64MWydWAqmikpDck4EPKnxw==';

const message2 = '{"userId":"6054ab12c988f0047291ba7f","siloUserId":"6054ab12c988f0047291ba80","applicationId":"5b2ce30bd9a0bf285ac70c10","applicationName":"Red Bull","createdAt":"2021-03-23T12:17:09.146Z","type":"REGISTRATION_VERIFIED","info":{"country":"ES","socialMediaAccounts":[],"formSubmissionId":"6059dc4537ccda2ea367b8e7","origin":"native","verifiedAt":"2021-03-23T12:17:09.146489Z","language":"de","source":"TESTING","avatar":{},"unmappedFields":{},"verificationPending":false,"userType":"registered","fields":[{"key":"first_name","value":"Pablo","mandatory":true,"type":"TEXT"},{"key":"last_name","value":"Torregroshhajgjha","mandatory":true,"type":"TEXT"},{"key":"email","value":"pablo.torregrosapaez@redbull.com","mandatory":true,"type":"TEXT","verified":true}],"submittedAt":"2021-03-23T12:17:09.146489Z","formAlias":"rb_the_cans_are_out_there_2021","userConsents":[{"masterDocumentId":"570ca270-01ce-484c-887f-4601f33f2a22","documentId":"custom_c4077ad4-fe46-4ffb-a065-d0eb96f4c0b6","title":"custom_participation","mandatory":false,"accepted":true,"type":"participation","version":"custom_policy_version_1","timeOfConsent":"2021-03-23T12:17:09.187312Z","url":"https://www.redbull.com/","custom":true,"renderingType":"explicit"},{"masterDocumentId":"b1478104-6594-41ef-906b-abba99d20ab2","documentId":"b5edb2c5-69a8-4059-84c5-354a7a9483f3","title":"Privacy Policy - Automation - International","mandatory":true,"accepted":true,"type":"privacy","version":"9","timeOfConsent":"2021-03-23T12:17:09.165Z","url":"https://policies.redbull.com/policies/Red_Bull_Global/202101121100/en/privacy.html","custom":false,"renderingType":"implicit"}]},"userAgent":{"device":{"name":"Unknown","brand":"Unknown","class":"Unknown"},"os":{"name":"Unknown","class":"Unknown","version":"Unknown"},"agent":{"name":"PostmanRuntime","class":"Special","version":"7.26.10"}},"geoLocation":{"country":"AT","city":"VIENNA","latitude":"48.20","longitude":"16.37"},"advertising":{}}';
const signature2 = 'er74RVTYFcfFOOkqglRXNnORaQsyiGMvY9wqJnJNXuIlm89hR4N3moXoj6mNxz14WzxYhBykmlGVuJmcK0XFtTitRz9txqK62acSqozzH8k7DE7HvzKf73jYenF9JONqDD3tAEOhsx34M9M2DFxVmuJ2FGYk0NJ7ifGXPTotnelE26YqTtcClfvNBOAMpthBMdrSfrVySJlbTJjJ8HYvjsbDrjKypvv+XWx3KfxXpAHBT0TdzCPZbC9tbqxdATSgmUCgbMn27/d9vcQZUVRcCq0KBqgvNRcYo4riMoQ6G6qjlyplIWx59/Ji6dY5LUyXkn6fSuOcmTTj57SVC8s1ww==';
// The public key for your application/silo can be found here https://platformservices.redbull.com/docs/authenticating-with-uim-jwt#section-where-do-i-get-the-public-key-from
const key =
    '-----BEGIN PUBLIC KEY-----\n' +
	'MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAoGtcnk6EuBCOaHZWk1R0\n' +
	'8cihHjRvEqdt0wZQcz71TfekSsEP2rk8rFR/xeB0iZVFNNqaia3oZTHP21A3LRhG\n' +
	'uXGuDdAR3+558bSw1C9lha6bqYZIQEytxE2kdjAMLMclG2xqwplE4oraa2O2VTj4\n' +
	'GYcY3W4tNZR9Np8HzGPWTOjZzMG6gYWPolgLVfQ/rFFmQs1ksyskcMYcUDoygHpu\n' +
	'qvUFtdLXQCBC7fhqk6LnYskJEpg52pX9pTB8OjH7fSpVJaApMAYjaO4sSI+Gmeb5\n' +
	'gNgvV0AB4AciZNJ69CEkn/pMSF3inNiKWZKDe93X9Cu34fghPu2A7VNz0fktP8eb\n' +
	'XwIDBlU3\n' +
	'-----END PUBLIC KEY-----\n';


let verifier = crypto.createVerify('RSA-SHA256');
verifier.update(message2);
const verified = verifier.verify(key, signature2, 'base64');
console.log(verified);
