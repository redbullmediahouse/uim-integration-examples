const crypto = require('crypto');

const message = '{"userId":"5f490e89b58006359a21753f","siloUserId":"5f490e89b58006359a217540","applicationId":"5b69aad46cf49d061fae5ba7","applicationName":"Red Bull Basement University","createdAt":"2020-09-01T06:50:46.654014Z","type":"REGISTRATION_VERIFIED","info":{"country":"AU","socialMediaAccounts":[],"accepted_newsletters":[{"id":"5d304d0a50a9d705ff4d2836","name":"Xivado"}],"formSubmissionId":"5f4def467a34377a1569b1d2","origin":"native","verifiedAt":"2020-09-01T06:50:46.654014Z","language":"en","source":"L89-1","avatar":{},"unmappedFields":{"type":"contact"},"verificationPending":false,"userType":"registered","fields":[{"key":"first_name","value":"Pablo","mandatory":false,"type":"TEXT"},{"key":"last_name","value":"Torregrosa","mandatory":false,"type":"TEXT"},{"key":"email","value":"pablo.torregrosa@redbull.com","mandatory":true,"type":"TEXT","verified":false},{"key":"zip_code","value":"1234567890","mandatory":false,"type":"TEXT"},{"key":"address","value":"Test","mandatory":false,"type":"TEXT"},{"key":"gender","value":"MALE","mandatory":false,"type":"SELECT_SINGLE"},{"key":"country","value":"AT","mandatory":false,"type":"SELECT_SINGLE"},{"key":"city","value":"Salzburg","mandatory":false,"type":"TEXT"}],"submittedAt":"2020-09-01T06:50:46.654014Z","formAlias":"rb_basement_university_xivado","userConsents":[{"masterDocumentId":"9c8921d9-c171-4f9b-b1bc-7a11fa45ae37","documentId":"aa1ff602-a8b7-40dd-b930-b80f60e4503a","title":"Direct Marketing Consent - Red Bull GmbH","mandatory":false,"accepted":true,"type":"direct_marketing","version":"2","timeOfConsent":"2020-09-01T06:50:46.671Z","url":"https://policies.redbull.com/policies/Red_Bull_Basement_2020_Participation/202008250731/en/direct_marketing.html","custom":false,"renderingType":"explicit"},{"masterDocumentId":"433f0e03-b5c3-4821-b78e-8ec6a1208a44","documentId":"95ca35bb-4086-4375-bfcc-3f087435b5d7","title":"Booking Terms - Free Events - Red Bull GmbH (Xivado)","mandatory":true,"accepted":true,"type":"booking_terms","version":"2","timeOfConsent":"2020-09-01T06:50:46.671Z","url":"https://policies.redbull.com/policies/Red_Bull_Basement_2020_Participation/202008250731/en/booking_terms.html","custom":false,"renderingType":"explicit"},{"masterDocumentId":"30e4a3c4-4e24-4786-a066-de84975b2ddf","documentId":"975c7643-66fe-46ae-bdb9-c59cacf77016","title":"Collection Statement - Red Bull GmbH (Xivado)","mandatory":true,"accepted":true,"type":"collection_statement","version":"5","timeOfConsent":"2020-09-01T06:50:46.671Z","url":"https://policies.redbull.com/policies/Red_Bull_Basement_2020_Participation/202008250731/en_AU/collection_statement.html","custom":false,"renderingType":"implicit"},{"masterDocumentId":"2dd52ce3-0565-4245-a1a5-fe2c9793449f","documentId":"9fb88334-72cf-4946-84d5-32be7b386639","title":"Terms of Participation - Red Bull GmbH (Basement University 2020)","mandatory":true,"accepted":true,"type":"participation","version":"3","timeOfConsent":"2020-09-01T06:50:46.671Z","url":"https://policies.redbull.com/policies/Red_Bull_Basement_2020_Participation/202008250731/en/participation.html","custom":false,"renderingType":"explicit"},{"masterDocumentId":"90765f4b-7a99-4a6e-82b6-597217f41e61","documentId":"8f8a4ae6-6bc8-4cfa-9c0c-4360917be885","title":"Participant Disclaimer - Red Bull GmbH (Basement University 2020)","mandatory":true,"accepted":true,"type":"disclaimer","version":"2","timeOfConsent":"2020-09-01T06:50:46.671Z","url":"https://policies.redbull.com/policies/Red_Bull_Basement_2020_Participation/202008250731/en/disclaimer.html","custom":false,"renderingType":"explicit"}]},"userAgent":{"device":{"name":"Unknown","brand":"Unknown","class":"Unknown"},"os":{"name":"Unknown","class":"Unknown","version":"Unknown"},"agent":{"name":"GuzzleHttp","class":"Special","version":"6.3.3"}},"geoLocation":{"country":"IE","city":"DUBLIN","latitude":"53.33","longitude":"-6.25"},"advertising":{}}';
// This should be read from the header X-UIM-RSA-Signature-value
const signature = 'ke8q4hYQ1XMmndiTdZVqB4LovXP27Ue2UTMFZ0tGrhoy/rh53bkb2fzAIUV4z8yBsCWJVJ1/EFhHUyGGKjD3MiWahCZt/PsHLB+I1QOQO9lBJnr3XGmKfdTdGnh0if45ERI7YvVKcOx3bGJNDeaHQsFxckfUcsuZXm6O6Gr/JqFCha1hV95RDMX5a2WT7cp8AbLCa9NFXduP6IkAYss3FAKg6vvqKZXOMDaw58+MvEzQvoH1F4L0OqR6FuQj7fCbtdQ64405zncfAFPSfGPsaoASjPgc6KQznV0LoOvsHlYMmEc0uiyiTLEKayS1VLMzSJFsf1FGFJMuV2MsJJMNdA==';
// The public key for your application/silo can be found here https://platformservices.redbull.com/docs/authenticating-with-uim-jwt#section-where-do-i-get-the-public-key-from
const key =
    '-----BEGIN PUBLIC KEY-----\n' +
    'MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAoGtcnk6EuBCOaHZWk1R0\n' +
    '8cihHjRvEqdt0wZQcz71TfekSsEP2rk8rFR/xeB0iZVFNNqaia3oZTHP21A3LRhG\n' +
    'uXGuDdAR3+558bSw1C9lha6bqYZIQEytxE2kdjAMLMclG2xqwplE4oraa2O2VTj4\n' +
    'GYcY3W4tNZR9Np8HzGPWTOjZzMG6gYWPolgLVfQ/rFFmQs1ksyskcMYcUDoygHpu\n' +
    'qvUFtdLXQCBC7fhqk6LnYskJEpg52pX9pTB8OjH7fSpVJaApMAYjaO4sSI+Gmeb5\n' +
    'gNgvV0AB4AciZNJ69CEkn/pMSF3inNiKWZKDe93X9Cu34fghPu2A7VNz0fktP8eb\n' +
    'XwIDBlU3\n' +
    '-----END PUBLIC KEY-----\n';

let verifier = crypto.createVerify('RSA-SHA256');
verifier.update(message);
const verified = verifier.verify(key, signature, 'base64');
console.log(verified);
